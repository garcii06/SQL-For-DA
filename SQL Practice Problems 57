-- Introductory problems
-- 1. Which shippers do we have?
SELECT *
FROM Northwind..Shippers;

-- 2. Certain fields from Categories
SELECT CategoryName, Description
FROM Northwind..Categories;

-- 3. Sales Representatives
SELECT FirstName, LastName, HireDate
FROM Northwind..Employees
WHERE Title IN ('Sales Representative');

-- 4. Sales Representatives in the United States
SELECT FirstName, LastName, HireDate
FROM Northwind..Employees
WHERE Title IN ('Sales Representative') AND Country IN ('USA');

-- 5. Orders placed by specific EmployeeID
SELECT OrderID, OrderDate
FROM Northwind..Orders
WHERE EmployeeID = 5;

-- 6. Suppliers and ContactTitles
SELECT SupplierID, ContactName, ContactTitle
FROM Northwind..Suppliers
WHERE ContactTitle NOT IN ('Marketing Manager');

-- 7. Products with “queso” in ProductName
SELECT ProductID, ProductName
FROM Northwind..Products
WHERE ProductName LIKE '%queso%';

-- 8. Orders shipping to France or Belgium
SELECT OrderID, CustomerID, ShipCountry
FROM Northwind..Orders
WHERE ShipCountry IN ('France', 'Belgium');

-- 9. Orders shipping to any country in Latin America
SELECT OrderID, CustomerID, ShipCountry
FROM Northwind..Orders
WHERE ShipCountry IN ('Brazil', 'Mexico', 'Argentina', 'Venezuela');

-- 10. Employees, in order of age
SELECT FirstName, LastName, Title, BirthDate
FROM Northwind..Employees
ORDER BY BirthDate;

-- 11. Showing only the Date with a DateTime field
SELECT FirstName, LastName, Title, CONVERT(DATE,BirthDate) AS BirthDate
FROM Northwind..Employees
ORDER BY BirthDate;

-- 12. Employees full name
SELECT FirstName, LastName, CONCAT(FirstName, ' ', LastName) AS FullName
FROM Northwind..Employees;

-- 13. OrderDetails amount per line item
SELECT OrderID, ProductID, UnitPrice, Quantity, (UnitPrice * Quantity) AS TotalPrice
FROM Northwind..OrderDetails
ORDER BY OrderID, ProductID;

-- 14. How many customers?
SELECT COUNT(CustomerID) AS TotalCustomers
FROM Northwind..Customers;

-- 15. When was the first order?
-- Same result
--SELECT TOP 1 OrderDate AS FirstOrder
--FROM Northwind..Orders
--ORDER BY OrderDate;
SELECT MIN(OrderDate) AS FirstOrder
FROM Northwind..Orders;

-- 16. Countries where there are customers
SELECT DISTINCT Country
FROM Northwind..Customers;
-- Same result
--SELECT Country
--FROM Northwind..Customers
--GROUP BY Country;

-- 17. Contact titles for customers
SELECT ContactTitle, COUNT(*) AS TotalContactTitle
FROM Northwind..Customers
GROUP By ContactTitle
ORDER BY TotalContactTitle DESC;

-- 18. Products with associated supplier names
SELECT ProductID, ProductName, CompanyName
FROM Northwind..Products prod JOIN Northwind..Suppliers supp 
ON prod.SupplierID = supp.SupplierID
ORDER BY ProductID;

-- 19. Orders and the Shipper that was used
SELECT OrderID, CONVERT(DATE, OrderDate) AS OrderDate, CompanyName
FROM Orders ords JOIN Shippers shps 
ON ords.ShipVia = shps.ShipperID
WHERE OrderID < 10300;

-- Intermediate Problems

-- 20. Categories, and the total products in each category
SELECT CategoryName, COUNT(prod.CategoryID) AS TotalProducts
FROM Northwind..Categories cate JOIN Northwind..Products prod
	ON cate.CategoryID = prod.CategoryID
GROUP BY CategoryName
ORDER BY 2 DESC;

-- 21. Total customers per country/city
SELECT Country, City, COUNT(*) AS TotalCustomers
FROM Northwind..Customers
GROUP BY Country, City
ORDER BY 3 DESC;

-- 22. Products that need reordering
SELECT ProductID, ProductName, UnitsInStock, ReorderLevel
FROM Northwind..Products
WHERE UnitsInStock < ReorderLevel
ORDER BY ProductID;

-- 23. Products that need reordering, continued
SELECT ProductID, ProductName, UnitsInStock, UnitsOnOrder, ReorderLevel, Discontinued 
FROM Northwind..Products
WHERE ((UnitsInStock + UnitsOnOrder) <= ReorderLevel) AND Discontinued = 0
ORDER BY ProductID;

-- 24. Customer list by region
SELECT CustomerID, CompanyName, Region, 
CASE 
	WHEN Region IS NULL THEN 0
	ELSE 1
	END AS RegionFilter
FROM Northwind..Customers
ORDER BY RegionFilter DESC, Region, CustomerID;

-- 25. High freight charges
SELECT TOP 3 ShipCountry, AVG(Freight) AS AverageFreight
FROM Northwind..Orders
GROUP BY ShipCountry
ORDER BY AverageFreight DESC;

-- 26. High freight charges - 2015
SELECT TOP 3 ShipCountry, AVG(Freight) AS AverageFreight
FROM Northwind..Orders
WHERE YEAR(OrderDate) = 2015
GROUP BY ShipCountry
ORDER BY AverageFreight DESC;

-- 27. High freight charges with between
SELECT TOP 3 ShipCountry ,AverageFreight = avg(freight)
FROM Northwind..Orders
WHERE OrderDate BETWEEN '1/1/2015' AND '12/31/2015'
GROUP BY ShipCountry
ORDER BY AverageFreight DESC;

SELECT OrderID, OrderDate
FROM Northwind..Orders
WHERE OrderDate > '12/31/2015' AND OrderDate < '01/01/2016' AND ShipCountry IN ('France');

-- 28. High freight charges - last year 
SELECT TOP 3 ShipCountry, AVG(Freight) AS AverageFreight
FROM Northwind..Orders
WHERE OrderDate > (SELECT DATEADD(year, -1, MAX(OrderDate)) FROM Northwind..Orders)
GROUP BY ShipCountry
ORDER BY AverageFreight DESC;

-- 29. Inventory list
SELECT Empl.EmployeeID, LastName, Ords.OrderID, ProductName, Quantity
FROM (Northwind..Employees Empl JOIN Northwind..Orders Ords
	ON Empl.EmployeeID = Ords.EmployeeID) JOIN Northwind..OrderDetails Ordd 
	ON Ords.OrderID = Ordd.OrderID JOIN Northwind..Products Prod
	ON Ordd.ProductID = Prod.ProductID
ORDER BY Ords.OrderID, Prod.ProductID;

-- 30. Customers with no orders
SELECT Cust.CustomerID AS Customer_CustomerID, Ords.CustomerID AS Orders_CustomerID
FROM Northwind..Customers Cust LEFT JOIN Northwind..Orders Ords
	ON Cust.CustomerID = Ords.CustomerID
WHERE Ords.OrderID IS NULL;

-- 31. Customers with no orders for EmployeeID 4
SELECT Cust.CustomerID AS Customer_CustomerID, Ords.CustomerID AS Orders_CustomerID
FROM Northwind..Customers Cust LEFT JOIN Northwind..Orders Ords
	ON Cust.CustomerID = Ords.CustomerID AND Ords.EmployeeID = 4
WHERE Ords.OrderID IS NULL;
